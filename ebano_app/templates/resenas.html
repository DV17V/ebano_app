{% extends "base.html" %}
{% block title %}Mis reseÃ±as | Ã‰bano{% endblock %}

{% block content %}
<section class="panel-cliente">
  <div class="panel-header">
    <h2>Mis reseÃ±as</h2>
    <p>Visualiza y administra tus opiniones sobre nuestros vinos.</p>
  </div>

  <div class="panel-content">
    <!-- Mensajes flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="acciones-resenas">
      <a href="{{ url_for('tienda') }}" class="btn-artesanal">â† Volver a la tienda</a>
    </div>

    {% if reseÃ±as and reseÃ±as|length > 0 %}
      <div class="lista-resenas">
        {% for r in reseÃ±as %}
          <div class="resena-item">
            <div class="resena-header">
              <h4 class="producto-nombre-resena">{{ r.producto_nombre }}</h4>
              <span class="fecha-resena">{{ r.fecha.strftime('%d/%m/%Y') if r.fecha else 'Sin fecha' }}</span>
            </div>

            <div class="resena-calificacion">
              {% for i in range(r.calificacion|int) %}
                â­
              {% endfor %}
              <span class="calificacion-numero">({{ r.calificacion }}/5)</span>
            </div>

            <p class="resena-comentario">{{ r.comentario }}</p>

            <div class="resena-acciones">
              <a href="{{ url_for('editar_resena', id=r.id) }}" class="btn-mini editar">
                âœï¸ Editar
              </a>
              
              <form method="POST" action="{{ url_for('borrar_resena', id=r.id) }}" style="display:inline;" onsubmit="return confirm('Â¿EstÃ¡s seguro de eliminar esta reseÃ±a? Esta acciÃ³n no se puede deshacer.');">
                <button type="submit" class="btn-mini eliminar">
                  ğŸ—‘ï¸ Eliminar
                </button>
              </form>

              <a href="{{ url_for('producto', id=r.id_producto) }}" class="btn-mini ver-producto">
                ğŸ‘ï¸ Ver producto
              </a>
            </div>
          </div>
          <hr class="separador-resena">
        {% endfor %}
      </div>
    {% else %}
      <div class="sin-resenas">
        <p class="placeholder">No has escrito reseÃ±as todavÃ­a.</p>
        <p>Â¡Compra uno de nuestros vinos y comparte tu experiencia!</p>
        <a href="{{ url_for('tienda') }}" class="btn-artesanal">Ir a la tienda</a>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}