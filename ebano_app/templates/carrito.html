{% extends "base.html" %}
{% block title %}Mi Carrito | Ébano{% endblock %}

{% block content %}
<section class="carrito">
    <h1 class="titulo-carrito">Mi Carrito</h1>

    <!-- ========================================
         BLOQUE DE MENSAJES FLASH (NUEVO)
    ========================================= -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    <!-- ======================================== -->

    {% if carrito and carrito|length > 0 %}

        <form method="POST" action="{{ url_for('carrito') }}">
            <div class="carrito-items">

                {% for item in carrito %}
                <div class="item-carrito">

                    {% if item.imagen_url %}
                        <img src="{{ url_for('static', filename=item.imagen_url) }}" alt="{{ item.nombre }}">
                    {% else %}
                        <img src="{{ url_for('static', filename='img/default.png') }}" alt="{{ item.nombre }}">
                    {% endif %}

                    <div class="info-carrito">
                        <h2>{{ item.nombre }}</h2>

                        <p>Precio unitario: {{ item.precio|usd }}</p>

                        <label for="qty_{{ item.id }}">Cantidad:</label>
                        <input type="number" name="qty_{{ item.id }}" min="1" value="{{ item.cantidad }}" class="input-cantidad">

                        <p>Subtotal: {{ (item.precio * item.cantidad)|usd }}</p>
                    </div>
                </div>
                {% endfor %}

            </div>

            <button type="submit" class="btn-artesanal">Actualizar carrito</button>
        </form>

        <div class="carrito-total">
            <h3>Total: {{ total|usd }}</h3>

            <a href="{{ url_for('checkout') }}" class="btn-artesanal">Proceder al pago</a>
            <a href="{{ url_for('vaciar_carrito') }}" class="boton-volver">Vaciar carrito</a>
            <a href="{{ url_for('tienda') }}" class="boton-volver">← Volver a la tienda</a>
        </div>

    {% else %}
        <p class="carrito-vacio">Tu carrito está vacío.</p>
    {% endif %}

</section>
{% endblock %}
